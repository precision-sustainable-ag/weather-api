<!doctype html>

<script src="/pmj.js"></script>

<style>
  * {
    box-sizing: border-box;
  }

  .hidden {
    display: none;
  }

  #Parms {
    font: 13px arial;
  }

  #Parms tr:nth-child(13) td {
    border-top: 1px solid #aaa;
  }

  #Parms tr > *:nth-child(8),
  #Parms tr > *:nth-child(13),
  #Parms tr > *:nth-child(15) {
    border-left: 1px solid #333;
  }

  #Parms tr:nth-child(2) th,
  #Parms th[rowspan] {
    border-bottom: 1px solid #333;
  }

  #Parms input {
    pointer-events: none;
  }

  #Parms th:nth-child(n+1):nth-child(-n+7) {
    background: gold;
    color: black;
  }

  #Parms th:nth-child(n+8):nth-child(-n+12) {
    background: lightgreen;
    color: black;
  }

  #Parms th:nth-child(n+13):nth-child(-n+14) {
    background: orange;
    color: black;
  }

  #Parms th:nth-child(15) {
    background: lightblue;
    color: black;
  }

  #Parms td:nth-child(7) {
    white-space: nowrap;
  }

  #Parms td:nth-child(n+7):nth-child(-n+12) {
    text-align: center;
  }

  #Main {
    zmax-width: 1200px;
    margin: auto;
    background: white;
    padding: 1em;
    border: 1px solid #ddd;
    position: relative;
  }

  #Playground a {
    font-size: 90%;
  }

  body {
    background: #f4f4f4;
    color: #222;
  }

  body, table {
    font: 14px verdana, DejaVu Sans;
  }

  h1 {
    font-size: 130%;
  }

  h2 {
    font-size: 120%;
  }

  h3 {
    font-size: 110%;
    color: #58b;
  }

  .indent {
    margin-left: 2em;
  }

  i {
    color: brown;
  }

  li + li{
    margin-top: 1.5em;
  }

  th {
    background: #333;
    color: white;
  }

  table {
    border: 1px solid black;
    border-spacing: 0; 
    empty-cells: show;
  }

  td, th {
    padding: 0.2em 0.5em;
    border-right: 1px solid #ddd;
    border-bottom: 1px solid #bbb;
  }

  th {
    text-align: center;
  }

  .new {
    color: green;
    font-weight: bold;
  }

  span.note {
    font-style: italic;
    color: #666;
    margin-left: 3em;
    position: absolute;
    left: 30em;
  }

  span.note em {
    font-style: normal;
  }

  select {
    width: 100%;
    background: lightyellow;
  }

  select:focus {
    background: yellow;
  }

  span.focused {
    color: green;
    font-weight: bold;
  }
</style>  

<div id="Main">
  <h3>Usage</h3>

  <h4>Downloading real hourly data:</h4>
  <p class="indent">
    <span class="server"></span>hourly?<i>parameters</i>
  </p>

  <h4>Downloading 5-year hourly averages:</h4>
  <div class="indent">
    <span class="server"></span>averages?<i>parameters</i>
  </div>

  <h4>Downloading daily statistics:</h4>
  <p class="indent">
    <span class="server"></span>daily?<i>parameters</i>
  </p>

  <h4>... where <i>parameters</i> may include one or more of:</h4>
      <div class="indent">
        [lat=<i>latitude</i>[,<i>latitude</i>,&hellip;]&lon=<i>longitude</i>[,<i>longitude</i>&hellip;]]  <span class="note">You can enter multiple latitudes and longitudes.</span><br>
        [location=<i>location</i>]                                                <span class="note">Either <b>lat-lon</b> <em>or</em> <b>location</b> is required.</span><br><br>
        [&start=[<i>year</i>-]<i>month-day</i>]                                 <span class="note"><b>year</b> is optional for 5-year averages and will be ignored.  It's required otherwise.</span><br><br>
        [&end=[<i>year</i>-]<i>month-day</i>]                                   <span class="note">"</span><br><br>
        [&attributes=<i>column names</i>]<br><br>
        [&output=<b>json</b>|csv|html]<br><br>
        [&order=<i>parm1</i> [desc] [,<i>parm2</i> [desc] &hellip;]]<br><br>
        [&where=<i>condition</i>]                            <span class="note">A valid SQL expression, which limits the results of the query.</span><br><br>
        [&stats=<i>expression</i>]                           <span class="note">A valid SQL aggregate expression, which references the attributes.</span><br><br>
        [&options=rect]                                      <span class="note">Given two lat/lons, they will be treated as the corners of a rectangle [NE:SW or NW:SE].<br>Given a location, its northeast and southwest will be treated as the corners of a rectangle.<br>Data within the rectangle will be retrieved based on resolution.<br>Currently outputs NLDAS precipitation, but will output MRMS in the future.</span>
        <br><br><br><br><br>
        [&options=graph]                                     <span class="note">Show graphing options for HTML output.  (Does nothing for other output types.)</span>
        <br><br>
        [&options=gmt|utc]                                   <span class="note">Output in Coordinated Universal Time instead of local time.</span>
        <br><br>
        [&options=predicted]                                 <span class="note">Use real hourly data if available; otherwise, use 5-year average data.</span>
      </div>

  <hr>

  <div id="Playground">
    <h3>Playground</h3>
    <table>
      <tr><td>Type of data
          <td><select id="Type">
                <option data-parm="hourly?">Real hourly data</option>
                <option data-parm="averages?">5-year hourly averages</option>
                <option data-parm="daily?">Daily statistics</option>
              </select>
      <tr><td>Lat/Lon
          <td><select id="LatLon">
                <option          data-parm=""></option>
                <option selected data-parm="lat=39.03&lon=-76.87">[39.03, -76.87]</option>
                <option          data-parm="lat=39.03,42.33&lon=-76.87,-78.26">[39.03, -76.87], [42.33, -78.26]</option>
                <option          data-parm="lat=39.03,40.42,42.33&lon=-76.87,-80.35,-84.26">[39.03, -76.87], [40.42, -80.35], [42.33, -84.26]</option>
              </select>
      <tr><td>Location
          <td><select id="Location">
                <option></option>
                <option data-parm="location=Beltsville MD">Beltsville MD</option>
                <option data-parm="location=Prince George's County Maryland">Prince George's County Maryland</option>
                <option data-parm="location=Maryland">Maryland</option>
              </select>
      <tr><td>Dates
          <td><select>
                <option data-parm="start=2018-11-01&end=2018-11-01">Nov 1, 2018</option>
                <option data-parm="start=2018-11-01&end=2018-11-30">Nov 2018</option>
                <option data-parm="start=2018-01-01&end=2018-12-31">All of 2018
              </select>
      <tr><td>Attributes
          <td><select>
                <option>All attributes</option>
                <option data-parm="attr=lat,lon,air_temperature">lat,lon,air_temperature</option>
                <option data-parm="attr=lat,lon,TMP">lat,lon,TMP</option>
                <option data-parm="attr=lat,lon,TMP,pressure">lat,lon,TMP, pressure</option>
              </select>
      <tr><td>Where
          <td><select>
                <option></option>
                <option data-parm="where=air_temperature>8 and precipitation>0">Temperature > 8 &deg;C and Precipitation is detectable
              </select>
      <tr><td>Options
          <td><select>
                <option></option>
                <option data-parm="options=graph">graph</option>
                <option data-parm="options=rect">rect</option>
                <option data-parm="options=rect,graph">rect,graph</option>
                <option data-parm="options=rect,graph,gmt">rect,graph,GMT</option>
              </select>
      <tr><td>Output
          <td><select>
                <option data-parm="output=html">HTML</option>
                <option data-parm="output=json">JSON</option>
                <option data-parm="output=csv">CSV</option>
              </select>
    </table>
    <span style="font-size: 40px;color: green;">&#x261E;</span>
    <a target="_blank"></a>
  </div>
  <hr>

  <h3>Examples</h3>
  <p>The following display HTML tables.  Change <strong>output</strong> for json or csv.</p>
  <ol>
    <li><p>Show November 2018 real hourly data for Beltsville MD, all parameters:</p>
        <p class="indent"><a target="_blank"><span class="server"></span>hourly?lat=39.032056&lon=-76.873972&start=2018-11-01&end=2018-11-30&output=html</a>
    <li><p>Show Beltsville MD hourly March averages:</p>
        <p class="indent"><a target="_blank"><span class="server"></span>averages?lat=39.032056&lon=-76.873972&start=3-1&end=3-31&output=html</a></p>
    <li><p>Show Beltsville MD hourly March averages, all parameters:</p>
        <p class="indent"><a target="_blank"><span class="server"></span>averages?lat=39.032056&lon=-76.873972&start=3-1&end=3-31&output=html</a></p>
    <li><p>Show Beltsville MD hourly March temperature and humidity averages:</p>
        <p class="indent"><a target="_blank"><span class="server"></span>averages?lat=39.032056&lon=-76.873972&start=3-1&end=3-31&attributes=air_temperature,humidity&output=html</a></p>
    <li><p>Show yearly hourly averages for Beltsville MD, all parameters:</p>
        <p class="indent"><a target="_blank"><span class="server"></span>averages?lat=39.032056&lon=-76.873972&output=html</a>
    <li><p>Show November 2018 daily ranges and statistics for Beltsville MD, all parameters:</p>
        <p class="indent"><a target="_blank"><span class="server"></span>daily?lat=39.032056&lon=-76.873972&start=2018-11-01&end=2018-11-30&output=html</a>
    <li><p>Show November 2018 daily ranges and statistics for 2400 College Station Road Athens GA, all parameters:</p>
        <p class="indent"><a target="_blank"><span class="server"></span>daily?location=2400 College Station Road Athens GA&start=2018-11-01&end=2018-11-30&output=html</a>
    <li><p>Show November 2018 daily ranges and statistics for 2400 College Station Road Athens GA, temperature and specific humidity:</p>
        <p class="indent"><a target="_blank"><span class="server"></span>daily?location=2400 College Station Road Athens GA&start=2018-11-01&end=2018-11-30&attr=air_temperature,humidity&output=html</a>
    <li><p>Show November 2018 daily ranges and statistics for lat/lons [39.03, -76.87], [40.42, -80.35], [42.33, -84.26] :</p>
        <p class="indent"><a target="_blank"><span class="server"></span>daily?lat=39.03,40.42,42.33&lon=-76.87,-80.35,-84.26&start=2018-11-01&end=2018-11-30&attr=lat,lon,air_temperature,humidity&output=html</a>
    <li><p>Show November 2018 real hourly data for Beltsville MD's midpoint, ordered by descending air temperature:</p>
        <p class="indent"><a target="_blank"><span class="server"></span>hourly?lat=39.032056&lon=-76.873972&start=2018-11-01&end=2018-11-30&output=html&order=air_temperature desc</a>
    <li><p>Show November 1 2018 real hourly data for all of Clarke County GA.  Allow graphing:</p>
        <p class="indent"><a target="_blank"><span class="server"></span>hourly?location=clarke%20county%20georgia&start=2018-11-01&end=2018-11-1&output=html&options=rect,graph</a>
    <li><p>Show real hourly data Clarke County GA, <span class="date1"></span> through <span class="date2"></span>:</p>
        <p class="indent"><a target="_blank"><span class="server"></span>hourly?location=clarke%20county%20georgia&start=<span class="date1b"></span>&end=<span class="date2b"></span>&output=html</a>
    <li><p>Show hourly data Clarke County GA, <span class="date1"></span> through <span class="date2"></span>, substituting 5-year averages for missing data:</p>
        <p class="indent"><a target="_blank"><span class="server"></span>hourly?location=clarke%20county%20georgia&start=<span class="date1b"></span>&end=<span class="date2b"></span>&output=html&options=predicted</a>
  </ol>

  <hr>
  <h3>Notes</h3>
  <ul>
    <li><p>
          <em>Either</em> <strong>lat</strong> and <strong>lon</strong> <em>or</em> <strong>location</strong> is required.<br>
          The other parameters are optional and may appear in any order:
        </p>
        <p class="indent">
          <strong>start</strong> defaults to 1-1 for hourly averages, and it defaults to the earliest available date for real hourly data.<br>
          <strong>end</strong> defaults to 12-31 for hourly averages, and it defaults to the latest available date for real hourly data.<br>
          <strong>attributes</strong> defaults to all columns.<br>
          <strong>output</strong> defaults to JSON.
        </p>
    <li>Dates are stored in the database in UTC.  The server queries Google's timezone API to convert them to local time.
    <li>Date-times are always output as the first column, even if excluded from <strong>attributes</strong>.
    <li><p>Attributes can be entered as <strong>Shorthand</strong> or <strong>Database column</strong>:</p>
        <table id="Parms">
          <tr><th colspan="7">General Information<th class="hidden"><th class="hidden"><th class="hidden"><th class="hidden"><th class="hidden"><th class="hidden">
              <th colspan="5">Temporal Resolution<th class="hidden"><th class="hidden"><th class="hidden"><th class="hidden">            
              <th colspan="2">Hourly Data Availability<th class="hidden">
              <th rowspan="2">Additional Comments
          <tr><th>Parameter
              <th>Level, Layer
              <th>Database Column
              <th>Shorthand
              <th>Unit
              <th>Data Source
              <th>Spatial Resolution
              <th>Hourly
              <th>Daily Average, Min, Max
              <th>Daily Total
              <th>5-Year Hourly Average
              <th>Prediction
              <th>Date Begin
              <th>Date End
          <tr><td>Air temperature
              <td>2m above ground
              <td>air_temperature
              <td>TMP
              <td>[C]
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td><input type="checkbox" checked>
              <td><input type="checkbox" checked>
              <td><input type="checkbox">
              <td><input type="checkbox" checked>
              <td>TBD
              <td>01/01/2015
              <td>Present
              <td>-
          <tr><td>Specific humidity
              <td>2m above ground
              <td>humidity
              <td>SPFH
              <td>[kg kg-1]
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td><input type="checkbox" checked>
              <td><input type="checkbox" checked>
              <td><input type="checkbox">
              <td><input type="checkbox" checked>
              <td>TBD
              <td>01/01/2015
              <td>Present
              <td>-
          <tr><td>Relative humidity
              <td>2m above ground
              <td>relative_humidity
              <td>
              <td>fraction
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td><input type="checkbox" checked>
              <td><input type="checkbox" checked>
              <td><input type="checkbox">
              <td><input type="checkbox" checked>
              <td>TBD
              <td>01/01/2015
              <td>Present
              <td>-
          <tr><td>Atmospheric pressure
              <td>Surface
              <td>pressure
              <td>PRES
              <td>[Pa]
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td><input type="checkbox" checked>
              <td><input type="checkbox" checked>
              <td><input type="checkbox">
              <td><input type="checkbox" checked>
              <td>TBD
              <td>01/01/2015
              <td>Present
              <td>-
          <tr><td>Zonal wind speed
              <td>10m above ground
              <td>zonal_wind_speed
              <td>UGRD
              <td>[m s-1]
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td><input type="checkbox" checked>
              <td><input type="checkbox" checked>
              <td><input type="checkbox">
              <td><input type="checkbox" checked>
              <td>TBD
              <td>01/01/2015
              <td>Present
              <td>-
          <tr><td>Meridional wind speed
              <td>10m above ground
              <td>meridional_wind_speed
              <td>VGRD
              <td>[m s-1]
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td><input type="checkbox" checked>
              <td><input type="checkbox" checked>
              <td><input type="checkbox">
              <td><input type="checkbox" checked>
              <td>TBD
              <td>01/01/2015
              <td>Present<td>-
          <tr><td>Wind speed
              <td>10m above ground
              <td>wind_speed
              <td>
              <td>[m s-1]
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td><input type="checkbox" checked>
              <td><input type="checkbox" checked>
              <td><input type="checkbox">
              <td><input type="checkbox" checked>
              <td>TBD
              <td>01/01/2015
              <td>Present
              <td>-
          <tr><td>Downward short-wave radiation flux
              <td>Surface
              <td>shortwave_radiation
              <td>DSWRF
              <td>[W m-2]
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td><input type="checkbox" checked>
              <td><input type="checkbox">
              <td><input type="checkbox" checked>
              <td><input type="checkbox" checked>
              <td>TBD
              <td>01/01/2015
              <td>Present
              <td>-
          <tr><td>Downward long-wave radiation flux
              <td>Surface
              <td>longwave_radiation
              <td>DLWRF
              <td>[W m-2]
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td><input type="checkbox" checked>
              <td><input type="checkbox">
              <td><input type="checkbox" checked>
              <td><input type="checkbox" checked>
              <td>TBD
              <td>01/01/2015
              <td>Present
              <td>-
          <tr><td>Rain fraction of total cloud water
              <td>Surface
              <td>convective_precipitation
              <td>FRAIN
              <td>proportion
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td><input type="checkbox" checked>
              <td><input type="checkbox">
              <td><input type="checkbox" checked>
              <td><input type="checkbox" checked>
              <td>TBD
              <td>01/01/2015
              <td>Present
              <td>-
          <tr><td>Convective Available Potential Energy
              <td>180m above ground
              <td>potential_energy
              <td>CAPE
              <td>[J kg-1]
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td><input type="checkbox" checked>
              <td><input type="checkbox">
              <td><input type="checkbox" checked>
              <td><input type="checkbox" checked>
              <td>TBD
              <td>01/01/2015
              <td>Present
              <td>-
          <tr><td>Potential Evaporation
              <td>Surface
              <td>potential_evaporation
              <td>PEVAP
              <td>[kg m-2]
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td><input type="checkbox" checked>
              <td><input type="checkbox">
              <td><input type="checkbox" checked>
              <td><input type="checkbox" checked>
              <td>TBD
              <td>01/01/2015
              <td>Present
              <td>-
          <tr><td rowspan="2">Rainfall
              <td rowspan="2">Surface
              <td rowspan="2">precipitation
              <td rowspan="2">APCP
              <td rowspan="2">[mm]
              <td><a target="_blank" href="https://hydro1.gesdisc.eosdis.nasa.gov/data/NLDAS/README.NLDAS2.pdf">NLDAS</a>
              <td>0.125° x 0.125°
              <td rowspan="2"><input type="checkbox" checked>
              <td rowspan="2"><input type="checkbox">
              <td rowspan="2"><input type="checkbox" checked>
              <td rowspan="2"><input type="checkbox" checked>
              <td rowspan="2">TBD
              <td>01/01/2015
              <td>05/05/2015
              <td>-
          <tr><td class="hidden">
              <td class="hidden">
              <td class="hidden">
              <td class="hidden">
              <td class="hidden">
              <td><a target="_blank" href="https://www.nssl.noaa.gov/projects/mrms/">MRMS</a>
              <td>1 km x 1 km
              <td class="hidden">
              <td class="hidden">
              <td class="hidden">
              <td class="hidden">
              <td class="hidden">
              <td>05/06/2015
              <td>Present
              <td>Only detectable precipitations are stored in the database (rainfall > 0)
        </table>
    <li>If you're using attributes with multiple lat/lons, be sure to include <strong>lat</strong> and <strong>lon</strong> in the attributes list.
    <li>For HTML output, you can sort a column by clicking its heading.
  <ul>
</div>

<script>
  const events = () => {
    $('span.server').text(location.origin + '/weather/');

    $('a:not([href])').attr('href', function() {
      return $(this).text();
    });

    $('#LatLon').change(function() {
      $('#Location').val('');
    });

    $('#Location').change(function() {
      $('#LatLon').val('');
    });

    $('#Playground select').focus(function() {
      $(this).change();
    });

    $('#Playground select').change(function() {
      let href = location.origin + '/weather/';
      let parms = [];
      let str = [];

      $('#Playground select option:checked').each(function() {
        let parm = $(this).data('parm');
        let focused = $(this).parent().is(':focus');

        if (parm) {
          parms.push(parm);
          if (focused) {
            str.push(`<span class="focused">${parm}</span>`);
          } else {
            str.push(parm);
          }
        }
      });

      $('#Playground a').html(href + str.join('&').replace('?&', '?'))[0].href = href + parms.join('&').replace('?&', '?');
    }).first().change();
  } // events

  const date1 = new Date(Date.now() - 12096e5);
  const date2 = new Date(Date.now() + 12096e5);
  $('.date1').text(dateFormat(date1, 'mmm dd, yyyy'));
  $('.date2').text(dateFormat(date2, 'mmm dd, yyyy'));
  $('.date1b').text(dateFormat(date1, 'yyyy-mm-dd'));
  $('.date2b').text(dateFormat(date2, 'yyyy-mm-dd'));

  events();
</script>